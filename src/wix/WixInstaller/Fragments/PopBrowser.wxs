<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" xmlns:util="http://schemas.microsoft.com/wix/WixVSExtension">
  <Fragment>
    <PropertyRef Id="VS2010_IDE_VCSHARP_PROJECTSYSTEM_INSTALLED"/>
    
    <CustomAction Id="SetOpenURLWithStudio" Property="WixShellExecTarget" Value="http://www.nservicebus.com/MSI?studio=true" />
    <CustomAction Id="SetOpenURLWithoutStudio" Property="WixShellExecTarget" Value="http://www.nservicebus.com/MSI?studio=false" />
    <CustomAction Id="OpenURL" BinaryKey="WixCA" DllEntry="WixShellExec" Impersonate="yes" Return="ignore" />

    <InstallExecuteSequence>
      <Custom Action="SetOpenURLWithStudio" Before="InstallFinalize"><![CDATA[VS2010_IDE_VCSHARP_PROJECTSYSTEM_INSTALLED AND (&IDEINTEGRATION_VS2010_NSB_STUDIO=3) AND NOT (REMOVE="ALL")]]></Custom>
      <Custom Action="SetOpenURLWithoutStudio" Before="InstallFinalize"><![CDATA[((NOT VS2010_IDE_VCSHARP_PROJECTSYSTEM_INSTALLED) OR (&IDEINTEGRATION_VS2010_NSB_STUDIO<>3)) AND NOT (REMOVE="ALL")]]></Custom>
      <Custom Action="OpenURL" After="InstallFinalize"><![CDATA[VS2010_IDE_VCSHARP_PROJECTSYSTEM_INSTALLED AND NOT (REMOVE="ALL")]]></Custom>
    </InstallExecuteSequence>
  </Fragment>
</Wix>